Introduction
============

A lot of the display code in GitX is based on the HTML views that are rendered
by WebKit. As such, it's necessary to access a lot of information from WebKit
that is only available in the Objective-C environment.

Because of this, some convenience methods have been added. Most notably, some
objects can be accessed completely from WebKit, including:

	* All webcontrollers
	* All PBGitRefs and PBGitCommits

All WebKit views should be controlled by a subclass of PBWebController.


Subclassing PBWebController
===========================

PBWebController does some magic to make using it easier. First of all, it
automatically loads in the view specified by "startFile". This means that
your views have to conform to a specific structure. For example, if you set
startFile (in your awakeFromNib) to "commit", there should be a file named
html/views/commit/index.html that will get loaded.

Furthermore, the controller keeps a finishedLoading member that indicates
whether or not the webview is ready to be used. If it is ready, and your
subclass has implemented the didLoad method, that method will be called.

After the document has successfully loaded, the controller inserts itself into
the Javascript environment under the "Controller" variable.

Communicating with native code
==============================

Views communicate with Objective-C by sending JSON messages through the shared
`gitxBridge` helper that is injected during bootstrap. Posting back to the
native controller looks like this:

	gitxBridge.post("requestCommitDiff", { path: "HEAD", contextLines: 3 });

Messages are delivered to the relevant `PBWebController` subclass via
`-handleBridgeMessage:payload:`. The helper automatically queues messages until
the native side is ready, so it is safe to post during page initialisation. If
your view needs to receive events from Objective-C, call
`gitxBridge.subscribe(handler)` and the handler will be invoked for every JSON
payload dispatched from the native side.

Loading files from WebKit
=========================

All views that have a subclass of PBWebController set as ResourceLoadDelegate
(this happens automatically if you assign a view to your controllers) gain
access to the GitX:// protocol. This protocol allows you to load in blobs from
the repository. The format is as follows:

	GitX://REVISION/path/to/file

Which means that revision can't have a path separator in it (so HEAD is valid,
but pu/pb/fix_it is not). You also can't just pass on a blob oid. These things
will probably be fixed in future revisions of the protocol.

What this allows you to do, for instance, is to display images that have
changed. For example, if you want to show the new file from a diff, you can
use something like

	<img src="GitX://HEAD:Images/new_file.png">
